<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">


<app-nav></app-nav>
<div class="container">
  <div class="form-container">
    <div class="hike-card">
      <form [formGroup]="hikeForm" (ngSubmit)="onSubmit()">
        <!-- Form fields -->
      <div class="form-field">
        <div class="form-title">
          <p>Nom de la randonnée</p>
        </div>
        <div class="form-field-bg">
          <mat-form-field appearance="outline">
            <input matInput type="text" formControlName="nomRandonnee">
            <mat-error *ngIf="nomRandonnee?.invalid && (nomRandonnee?.dirty || nomRandonnee?.touched)">
              <span *ngIf="nomRandonnee?.errors?.['required']">Le nom de la randonnée est requis</span>
              <span *ngIf="nomRandonnee?.errors?.['minlength']">Le nom de la randonnée doit contenir au moins 4 caractères</span>
              <span *ngIf="nomRandonnee?.errors?.['maxlength']">Le nom de la randonnée ne peut pas dépasser 70 caractères</span>
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <h1>Storage</h1>
        <label for="fileUpload">Choose a File</label>
        <input id="fileUpload" type="file" #upload>
        <button (click)="uploadFile(upload)">Upload</button>

      <!-- Image upload -->
      <div class="form-field">
        <div class="form-title">
          <p>Image</p>
        </div>
        <div class="dropzone">
          <h3>Drag and drop file here</h3>
          <h3>or</h3>
          <br>
          <label for="fileDropRef">Browse for file</label>
          <input type="file" accept="image/*" (change)="displayImage($event)">
          <img class="preview-image" *ngIf="imagePreview && !image?.invalid" [src]="imagePreview" alt="Selected Image" class="preview-image">
        </div>
        <mat-error *ngIf="imageSelected && image?.invalid">
          <span *ngIf="image?.errors?.['required']">L'image est requise</span>
          <span *ngIf="image?.errors?.['invalidFileType']">Format de fichier non pris en charge. Veuillez sélectionner une image.</span>
          <span *ngIf="image?.errors?.['invalidFileContent']">Fichier non valide. Veuillez sélectionner une image valide.</span>
        </mat-error>
      </div>

      <!-- Description -->
      <div class="form-field">
        <div class="form-title">
          <p>Description</p>
        </div>
        <mat-form-field appearance="outline">
          <textarea matInput formControlName="description"></textarea>
          <mat-hint>{{ description?.value?.length }}/255</mat-hint>
          <mat-error *ngIf="description?.invalid && (description?.dirty || description?.touched)">
            La description ne peut pas dépasser 255 caractères
          </mat-error>
        </mat-form-field>
      </div>


      <!-- Location -->
      <div class="form-field">
        <div class="form-title">
          <p>Emplacement</p>
        </div>
        <mat-form-field appearance="outline">
          <input matInput type="text" formControlName="location">
        </mat-form-field>
      </div>

      <!-- Type (Vélo ou pied) -->
      <div class="form-field">
        <div class="form-title">
          <p>Type</p>
        </div>
        
        <div class="button-group">
          <button [ngClass]="{'selected': hikeType === 'walk'}" (click)="setHikeType('walk')">
            <i class="fas fa-walking"></i>
          </button>
          <button [ngClass]="{'selected': hikeType === 'bike'}" (click)="setHikeType('bike')">
            <i class="fas fa-bicycle"></i>
          </button>
        </div>
        <!--
        <mat-form-field appearance="outline">
          <mat-select formControlName="type">
            <mat-option *ngFor="let type of hikeTypes" [value]="type">{{ type }}</mat-option>
          </mat-select>
          <mat-error *ngIf="type?.invalid && (type?.dirty || type?.touched)">
            Le type est requis
          </mat-error>
        </mat-form-field>-->
      </div>



      </form>

      <!-- Toggle buttons for selecting points A and B -->
      

      <!-- Display latitude and longitude for selected points -->
      
    </div>
  </div>

  <!-- Map section -->
  <div class="map-container">
    <div class="btnSend" (click)="onSubmit()">
      Create Hike
    </div>
    <div class="button-container">
      <button (click)="choosePoint('A')" [class.selected]="selectedPoint === 'A'">
        <i class="fas fa-play"></i><br>
        Start Point
      </button>
      <button (click)="choosePoint('B')" [class.selected]="selectedPoint === 'B'">
        <i class="fas fa-flag-checkered"></i><br>
        End Point
      </button>
      <div class="point-info" *ngIf="pointALatitude !== null && pointALongitude !== null">
        <p>Point de départ Latitude: {{ pointALatitude }}</p>
        <p>Point de départ Longitude: {{ pointALongitude }}</p>
      </div>
      <div class="point-info" *ngIf="pointBLatitude !== null && pointBLongitude !== null">
        <p>Point d'arrivée Latitude: {{ pointBLatitude }}</p>
        <p>Point d'arrivée Longitude: {{ pointBLongitude }}</p>
      </div>
    </div>
    <div class="map-section">
      <google-map id="map" #mapAB [center]="center" [zoom]="zoom" (mapClick)="placeMarker($event)" [width]="'100%'" [height]="'100%'">
        <map-marker *ngFor="let marker of markers" [position]="marker.position" height="100%"></map-marker>
      </google-map>
    </div>
  </div>
</div>
